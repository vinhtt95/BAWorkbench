<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Project Graph</title>
    <script type="text/javascript" src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #1E1F20;
        }
        #graph {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<div id="graph"></div>
<script type="text/javascript">
    var nodesJson = %%NODES_JSON%%;
    var edgesJson = %%EDGES_JSON%%;

    var nodes = new vis.DataSet(nodesJson);
    var edges = new vis.DataSet(edgesJson);

    var container = document.getElementById('graph');
    var data = {
        nodes: nodes,
        edges: edges
    };

    const darkBg = '#2a2b2e';
    const darkFont = '#E3E3E3';
    const defaultBorder = '#3c3f41';
    const highlightBg = '#007bff';
    const highlightBorder = '#E3E3E3';
    const hoverBg = '#3c3f41';
    const hoverBorder = '#888888';

    var options = {
        layout: {
            improvedLayout: false
        },
        nodes: {
            shape: 'box',
            font: {
                color: darkFont,
                size: 16
            },
            margin: 10,
            shapeProperties: {
                borderRadius: 4
            }
        },
        groups: {
            UC: {
                color: {
                    background: darkBg,
                    border: '#007bff',
                    highlight: { background: highlightBg, border: highlightBorder },
                    hover: { background: hoverBg, border: hoverBorder }
                },
                font: { color: darkFont }
            },
            BR: {
                color: {
                    background: darkBg,
                    border: '#8a63d2',
                    highlight: { background: highlightBg, border: highlightBorder },
                    hover: { background: hoverBg, border: hoverBorder }
                },
                font: { color: darkFont }
            },
            TSK: {
                color: {
                    background: darkBg,
                    border: '#E67E22',
                    highlight: { background: highlightBg, border: highlightBorder },
                    hover: { background: hoverBg, border: hoverBorder }
                },
                font: { color: darkFont }
            },
            REL: {
                color: {
                    background: darkBg,
                    border: '#1ABC9C',
                    highlight: { background: highlightBg, border: highlightBorder },
                    hover: { background: hoverBg, border: hoverBorder }
                },
                font: { color: darkFont }
            },
            default: {
                color: {
                    background: darkBg,
                    border: defaultBorder,
                    highlight: { background: highlightBg, border: highlightBorder },
                    hover: { background: hoverBg, border: hoverBorder }
                },
                font: { color: darkFont }
            }
        },
        edges: {
            arrows: 'to',
            color: {
                color: '#888888',
                highlight: darkFont,
                inherit: false
            },
            smooth: {
                type: 'cubicBezier',
                forceDirection: 'vertical',
                roundness: 0.4
            }
        },
        physics: {
            solver: 'forceAtlas2Based',
            forceAtlas2Based: {
                gravitationalConstant: -50,
                centralGravity: 0.01,
                springLength: 150,
                springConstant: 0.08,
                damping: 0.4
            },
            minVelocity: 0.75
        },
        interaction: {
            hover: true,
            tooltipDelay: 200,
            navigationButtons: true,
            keyboard: true
        }
    };

    const allGroups = [...new Set(nodesJson.map(node => node.group))];
    allGroups.forEach(groupName => {
        if (groupName && !options.groups[groupName]) {
            options.groups[groupName] = options.groups.default;
        }
    });

    var network = new vis.Network(container, data, options);

    /**
     * Thêm listener (trình lắng nghe)
     * cho double-click (UC-MOD-02, 1.0.A1, 6.5)
     */
    network.on("doubleClick", function (params) {
        if (params.nodes && params.nodes.length > 0) {
            var nodeId = params.nodes[0];
            console.log("Double-clicked node: " + nodeId);
            if (window.javaBridge) {
                window.javaBridge.onNodeDoubleClick(nodeId);
            } else {
                console.error("JavaBridge is not available.");
            }
        }
    });

</script>
</body>
</html>